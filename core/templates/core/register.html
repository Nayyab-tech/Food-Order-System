{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register - Food Ordering</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      background: url("{% static 'images/register.jpg' %}") no-repeat center center fixed;
      background-size: cover;
      padding-top: 70px; /* Navbar ki wajah se content ko niche karne ke liye */
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .navbar {
      background: linear-gradient(to right, #007bff, #00c6ff);
    }

    .navbar-brand {
      color: white !important;
      font-weight: bold;
      font-size: 1.6rem;
    }

    .register-container {
      max-width: 500px;
      margin: 80px auto;
      padding: 40px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 16px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .register-container h2 {
      font-weight: bold;
      color: #007bff;
    }

    .form-label {
      font-weight: 600;
      color: #333;
    }

    .form-control,
    .form-select {
      border-radius: 10px;
      padding: 12px;
    }

    .form-control:focus,
    .form-select:focus {
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.5);
      border-color: #007bff;
    }

    .btn-primary {
      background: linear-gradient(to right, #007bff, #00c6ff);
      border: none;
      font-weight: bold;
      transition: 0.3s ease;
      border-radius: 10px;
    }

    .btn-primary:hover {
      background: linear-gradient(to right, #0056b3, #009ac7);
    }

    .input-group-text {
      background: white;
      border-right: none;
      border-radius: 10px 0 0 10px;
    }

    .input-group .form-control {
      border-left: none;
      border-radius: 0 10px 10px 0;
    }

    .input-group-text i {
      color: #6c757d;
      transition: 0.3s;
    }

    .input-group-text:hover i {
      color: #007bff;
    }

    .text-muted a {
      color: #007bff;
      text-decoration: none;
    }

    .text-muted a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg px-4 shadow-sm fixed-top">
  <a class="navbar-brand" href="{% url 'home' %}">
    <i class="fas fa-utensils me-2"></i>FoodOrder
  </a>
</nav>

<div class="register-container">
  <h2 class="mb-4 text-center">Create Your Account</h2>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <form method="POST" novalidate enctype="multipart/form-data">
    {% csrf_token %}
    <div class="mb-3">
      <label for="first_name" class="form-label">First Name</label>
      <input type="text" class="form-control" id="first_name" name="first_name" placeholder="John" required />
    </div>

    <div class="mb-3">
      <label for="last_name" class="form-label">Last Name</label>
      <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Doe" required />
    </div>

    <div class="mb-3">
      <label for="email" class="form-label">Email Address</label>
      <input type="email" class="form-control" id="email" name="email" placeholder="example@mail.com" required />
    </div>

    <!-- New Phone Number Field -->
    <div class="mb-3">
      <label for="phone" class="form-label">Phone Number</label>
<input type="tel" class="form-control" id="phone" name="phone"
       placeholder="03XXXXXXXXX" required
       pattern="\d{11}" title="Phone number must be exactly 11 digits" />
    </div>

    <div class="mb-3">
      <label for="role" class="form-label">Role</label>
      <select class="form-select" id="role" name="role" required>
        <option value="" disabled selected>Select Role</option>
        <option value="customer">Customer</option>
        <option value="employee">Employee</option>
        <option value="admin">Admin</option>
      </select>
    </div>

    <!-- Admin Auth Fields (only for employee) -->
    <div class="mb-3" id="admin-auth-section" style="display: none;">
      <label for="admin_email" class="form-label">Admin Email (for verification)</label>
      <input type="email" class="form-control" id="admin_email" name="admin_email" placeholder="admin@example.com" />
    </div>

    <div class="mb-4" id="admin-auth-password-section" style="display: none;">
      <label for="admin_password" class="form-label">Admin Password</label>
      <input type="password" class="form-control" id="admin_password" name="admin_password" placeholder="••••••••" />
    </div>

    <!-- CNIC Field (always visible) -->
  <div class="mb-3" id="cnic-section">
  <label for="cnic" class="form-label">CNIC Number</label>
  <input type="text" class="form-control" id="cnic" name="cnic" 
         placeholder="12345-1234567-1" 
         maxlength="15" required />
</div>

    <!-- Date of Birth Field (always visible and required) -->
    <div class="mb-3" id="dob-section">
      <label for="date_of_birth" class="form-label">Date of Birth</label>
      <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" required />
    </div>

    <!-- Picture Upload (always visible) -->
    <div class="mb-3" id="picture-section">
      <label for="picture" class="form-label">Upload Picture</label>
      <input type="file" class="form-control" id="picture" name="picture" accept="image/*" />
    </div>

    <div class="mb-3">
      <label for="location" class="form-label">Location</label>
      <select class="form-select" id="location" name="location" required>
        <option value="" disabled selected>Select Location</option>
        <option value="kahuta">Kahuta</option>
        <option value="islamabad">Islamabad</option>
        <option value="lahore">Lahore</option>
        <option value="karachi">Karachi</option>
        <option value="multan">Multan</option>
      </select>
    </div>

    <div class="mb-4">
      <label for="password" class="form-label">Password</label>
      <div class="input-group">
        <span class="input-group-text"><i class="fa-solid fa-lock"></i></span>
        <input type="password" class="form-control" id="password" name="password" placeholder="••••••••" required />
        <span class="input-group-text" onclick="togglePassword()" style="cursor: pointer;">
          <i id="toggleIcon" class="fa-solid fa-eye"></i>
        </span>
      </div>
    </div>

    <button type="submit" class="btn btn-primary w-100 py-2">Register</button>
  </form>

  <p class="text-center mt-3 text-muted">Already have an account? <a href="{% url 'login' %}">Login here</a></p>
</div>

<script>
  const roleSelect = document.getElementById('role');
  const adminFields = document.getElementById('admin-auth-section');
  const adminPassword = document.getElementById('admin-auth-password-section');
  const cnicInput = document.getElementById('cnic');
  const pictureInput = document.getElementById('picture');

  roleSelect.addEventListener('change', function () {
    const role = this.value;

    if (role === 'employee' || role === 'admin') {
      adminFields.style.display = role === 'employee' ? 'block' : 'none';
      adminPassword.style.display = role === 'employee' ? 'block' : 'none';

      cnicInput.disabled = false;
      pictureInput.disabled = false;

      cnicInput.required = true;
      pictureInput.required = true;

    } else {
      adminFields.style.display = 'none';
      adminPassword.style.display = 'none';

      cnicInput.disabled = true;
      pictureInput.disabled = true;

      cnicInput.required = false;
      pictureInput.required = false;
    }
  });

  // Trigger change event once on page load to set initial state
  window.addEventListener('DOMContentLoaded', () => {
    roleSelect.dispatchEvent(new Event('change'));
  });

  function togglePassword() {
    const passwordInput = document.getElementById('password');
    const toggleIcon = document.getElementById('toggleIcon');
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      toggleIcon.classList.remove('fa-eye');
      toggleIcon.classList.add('fa-eye-slash');
    } else {
      passwordInput.type = 'password';
      toggleIcon.classList.remove('fa-eye-slash');
      toggleIcon.classList.add('fa-eye');
    }
  }
  const registerContainer = document.querySelector('.register-container');

roleSelect.addEventListener('change', function () {
  const role = this.value;

  // Existing admin fields toggle
  if (role === 'employee' || role === 'admin') {
    adminFields.style.display = role === 'employee' ? 'block' : 'none';
    adminPassword.style.display = role === 'employee' ? 'block' : 'none';

    cnicInput.disabled = false;
    pictureInput.disabled = false;

    cnicInput.required = true;
    pictureInput.required = true;
  } else {
    adminFields.style.display = 'none';
    adminPassword.style.display = 'none';

    cnicInput.disabled = true;
    pictureInput.disabled = true;

    cnicInput.required = false;
    pictureInput.required = false;
  }


  // Background images based on role
if (role === 'customer') {
  document.body.style.background = "url('{% static 'images/customers.jpg' %}') no-repeat center center fixed";
  document.body.style.backgroundSize = "cover";
} else if (role === 'employee') {
  document.body.style.background = "url('{% static 'images/employee.jpg' %}') no-repeat center center fixed";
  document.body.style.backgroundSize = "cover";
} else if (role === 'admin') {
  document.body.style.background = "url('{% static 'images/admin.jpg' %}') no-repeat center center fixed";
  document.body.style.backgroundSize = "cover";
} else {
  document.body.style.background = "url('{% static 'images/register.jpg' %}') no-repeat center center fixed";
  document.body.style.backgroundSize = "cover";
}

});

//cnic check 
const cnicField = document.getElementById("cnic");

cnicField.addEventListener("input", function () {
  // Sirf numbers nikaalein
  let value = this.value.replace(/\D/g, ""); 

  // Limit to exactly 13 digits
  if (value.length > 13) {
    value = value.slice(0, 13);
  }

  // Dash formatting (12345-1234567-1)
  let formatted = "";
  if (value.length > 0) {
    if (value.length <= 5) {
      formatted = value;
    } else if (value.length <= 12) {
      formatted = value.slice(0, 5) + "-" + value.slice(5);
    } else {
      formatted = value.slice(0, 5) + "-" + value.slice(5, 12) + "-" + value.slice(12);
    }
  }

  this.value = formatted;
});
// for phone number 
const phoneField = document.getElementById("phone");
phoneField.addEventListener("input", function () {
  this.value = this.value.replace(/\D/g, "");   // sirf numbers
  if (this.value.length > 11) {
    this.value = this.value.slice(0, 11);
  }
});

// Pehle variables mein DOB section ko add karein
const dobSection = document.getElementById('dob-section');
const dobInput = document.getElementById('date_of_birth');

roleSelect.addEventListener('change', function () {
    const role = this.value;

    if (role === 'employee' || role === 'admin') {
        // ... aapka purana admin logic ...
        
        // DOB ko Show karein
        dobSection.style.display = 'block';
        dobInput.required = true;
    } else {
        // ... aapka purana customer logic ...

        // DOB ko Hide karein agar role Customer hai
        dobSection.style.display = 'none';
        dobInput.required = false;
    }
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
